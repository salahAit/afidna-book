% \usepackage[utf8]{inputenc} - Not needed for XeLaTeX
\usepackage{fontspec}
\setmainfont{FreeSerif} 
\setsansfont{FreeSans}
\setmonofont{FreeMono}

\usepackage{geometry}
\geometry{a4paper, margin=1in}
\usepackage{graphicx}
\usepackage{hyperref}
\usepackage{titlesec}
\usepackage{fancyhdr}
\usepackage{listings}
\usepackage{xcolor}
\usepackage{bookmark}
\usepackage{longtable}
\usepackage{booktabs}
\usepackage{array}
\usepackage{calc}
\usepackage{tcolorbox}
\usepackage{etoolbox}

% Typography improvements
\linespread{1.15}

% Custom Colors
\definecolor{primaryBlue}{RGB}{0, 51, 102}
\definecolor{lightGray}{RGB}{245, 245, 245}
\definecolor{borderGray}{RGB}{200, 200, 200}

% Chapter Styling
\titleformat{\chapter}[display]
  {\normalfont\huge\bfseries\sffamily\color{primaryBlue}}
  {\chaptertitlename\ \thechapter}{20pt}{\Huge}
\titlespacing*{\chapter}{0pt}{-20pt}{40pt}

% Section Styling
\titleformat{\section}
  {\normalfont\Large\bfseries\sffamily\color{primaryBlue}}
  {\thesection}{1em}{}
  
\titleformat{\subsection}
  {\normalfont\large\bfseries\sffamily\color{primaryBlue}}
  {\thesubsection}{1em}{}

% Redefine Quote Environment for Blockquotes (Notes/Tips)
\AtBeginEnvironment{quote}{
    \begin{tcolorbox}[colback=lightGray,colframe=borderGray,arc=0pt,boxrule=0.5pt,left=10pt,right=10pt,top=10pt,bottom=10pt]
    \small\sffamily
}
\AtEndEnvironment{quote}{
    \end{tcolorbox}
}

% Hyperlink setup
\hypersetup{
    colorlinks=true,
    linkcolor=primaryBlue,
    filecolor=magenta,      
    urlcolor=primaryBlue,
    pdftitle={Building a Modern Educational Platform},
    pdfpagemode=FullScreen,
}

% Header and Footer
\pagestyle{fancy}
\fancyhf{}
\setlength{\headheight}{15pt}
\fancyhead[L]{\sffamily\small \leftmark}
\fancyhead[R]{\sffamily\small \textbf{\thepage}}
\fancyfoot[L]{\sffamily\scriptsize Afidna Project}
\fancyfoot[R]{\sffamily\scriptsize \thepage}
\renewcommand{\headrulewidth}{0.4pt}
\renewcommand{\footrulewidth}{0.4pt}

% Code listing style
\definecolor{codegreen}{rgb}{0,0.6,0}
\definecolor{codegray}{rgb}{0.5,0.5,0.5}
\definecolor{codepurple}{rgb}{0.58,0,0.82}
\definecolor{backcolour}{rgb}{0.96,0.96,0.96}

\lstdefinestyle{mystyle}{
    backgroundcolor=\color{backcolour},   
    commentstyle=\color{codegreen},
    keywordstyle=\color{magenta},
    numberstyle=\tiny\color{codegray},
    stringstyle=\color{codepurple},
    basicstyle=\ttfamily\scriptsize,
    breakatwhitespace=false,         
    breaklines=true,                 
    captionpos=b,                    
    keepspaces=true,                 
    numbers=left,                    
    numbersep=5pt,                  
    showspaces=false,                
    showstringspaces=false,
    showtabs=false,                  
    tabsize=2,
    frame=single,
    rulecolor=\color{borderGray}
}

\lstset{style=mystyle}

% Define passthrough and tightlist if not already defined
\newcommand{\passthrough}[1]{#1}
\providecommand{\tightlist}{
  \setlength{\itemsep}{4pt}\setlength{\parskip}{0pt}}

% Spacing for paragraphs
\setlength{\parskip}{0.8em}
\setlength{\parindent}{0pt}

% Pandoc image handling
\providecommand{\pandocbounded}[1]{#1}
\makeatletter
\def\maxwidth{\ifdim\Gin@nat@width>\linewidth\linewidth\else\Gin@nat@width\fi}
\def\maxheight{\ifdim\Gin@nat@height>\textheight\textheight\else\Gin@nat@height\fi}
\makeatother
\setkeys{Gin}{width=\maxwidth,height=\maxheight,keepaspectratio}